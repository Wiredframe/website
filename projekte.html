<!doctype html>
<html lang="de">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<!-- Prevent search engines from indexing this page -->
	<meta name="robots" content="noindex, nofollow, noarchive, nosnippet">
	<meta name="googlebot" content="noindex, nofollow">
	<meta name="bingbot" content="noindex, nofollow">
	<!-- Prevent LLMs / AI crawlers from ingesting this page -->
	<meta name="llm" content="noindex, nofollow, noarchive, nosnippet, do-not-ingest">
	<meta name="ai" content="noindex">
	<meta name="ai-policy" content="do-not-ingest">
	<meta http-equiv="x-robots-tag" content="noindex, nofollow, noarchive">
	<title>Referenzen — Wiredframe</title>
	<link href="https://fonts.googleapis.com/css2?family=Maven+Pro:wght@300;400;500;700;900&display=swap"
		rel="stylesheet">
	<script src="js/tailwind.js"></script>
	<style>
		/* Tailwind config overrides for roundness and minimal look */
		:root {
			--rounded-lg: 18px
		}

		.card {
			border-radius: var(--rounded-lg);
		}

		.pill {
			border-radius: 9999px;
		}

		/* remove shadows globally for this page */
		.no-shadow * {
			box-shadow: none !important;
		}

		body {
			font-family: 'Maven Pro', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
		}

		/* Image intrinsic-size + aspect ratio to avoid layout shift for lazy images */
		.placeholder-img {
			background-color: #f3f4f6;
			/* separate durations: --img-fade-duration controls opacity fade, --img-pan-duration controls object-position pan */
			--img-fade-duration: 360ms;
			--img-pan-duration: 300ms;
			--img-pan-ease: cubic-bezier(.2, .8, .2, 1);
			object-position: top;
			opacity: 0;
			transition: opacity var(--img-fade-duration) ease, object-position var(--img-pan-duration) var(--img-pan-ease);
		}

		/* card thumbnails: disable image pan on hover (we want modal hover pan only) */
		/* (previously .group:hover controlled pan; removed to keep thumbnails static) */
		/* clickable linked cards: subtle lift on hover */
		.card.clickable-url {
			cursor: pointer;
			transition: transform 180ms ease, box-shadow 180ms ease;
		}

		.card.clickable-url:hover {
			transform: translateY(-6px);
			box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
		}

		/* modal image: disable pan; instead make image scrollable vertically on hover */
		.modal-image {
			overflow-y: hidden;
		}

		.modal-image:hover {
			overflow-y: auto;
		}

		.modal-image .placeholder-img {
			object-position: top;
		}

		/* custom scrollbar (webkit) shown on hover */
		.modal-image::-webkit-scrollbar {
			width: 8px;
		}

		.modal-image::-webkit-scrollbar-thumb {
			background: rgba(0, 0, 0, 0.18);
			border-radius: 999px;
		}

		/* firefox scrollbar control */
		.modal-image {
			scrollbar-width: none;
		}

		.modal-image:hover {
			scrollbar-width: thin;
			scrollbar-color: rgba(0, 0, 0, 0.18) transparent;
		}

		/* visible state when image finished loading */
		.placeholder-img.is-loaded {
			opacity: 1;
		}

		/* custom select arrow: hide native arrow and show a subtle SVG */
		.filter-bar select {
			/* remove default */
			-webkit-appearance: none;
			-moz-appearance: none;
			appearance: none;
			background-repeat: no-repeat;
			background-position: right 0.9rem center;
			background-size: 1.25rem;
			padding-right: 2.5rem;
			/* ensure space for icon */
		}

		/* subtle inline SVG arrow (gray) */
		.filter-bar select {
			background-image: url("data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%239CA3AF'%3E%3Cpath d='M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z'/%3E%3C/svg%3E");
		}

		/* Simplified native dialog styling: use ::backdrop and restrict modal content height */
		dialog#card-modal {
			padding: 0;
			border: 0;
			background: transparent;
		}

		dialog#card-modal::backdrop {
			/* background: rgba(0, 0, 0, 0.5); */
			backdrop-filter: blur(32px);
		}

		.modal-content {
			border-radius: var(--rounded-lg);
			max-height: calc(100vh - 4rem);
			overflow: auto;
		}

		/* when modal open, lock page scroll by applying this class to <body> */
		body.modal-scroll-lock {
			position: fixed !important;
			inset: 0;
			/* top:0; right:0; bottom:0; left:0 */
			overflow: hidden !important;
			width: 100%;
		}

		/* modal navigation buttons inside right column */
		.modal-details {
			position: relative;
		}

		.modal-nav {
			position: absolute;
			right: 1rem;
			bottom: 1rem;
			display: flex;
			gap: .75rem;
		}

		.modal-nav button {
			width: 48px;
			height: 48px;
			border-radius: 9999px;
			border: 1px solid rgba(0, 0, 0, 0.08);
			background: white;
			display: flex;
			align-items: center;
			justify-content: center;
			cursor: pointer;
		}

		.modal-nav button:hover {
			transform: translateY(-2px);
		}

		/* use inline SVG as icon for modal nav buttons */
		.modal-nav button::before {
			content: '';
			display: block;
			width: 18px;
			height: 18px;
			background-repeat: no-repeat;
			background-position: center;
			background-size: contain;
			background-image: url("data:image/svg+xml;utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%239CA3AF'%3E%3Cpath d='M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z'/%3E%3C/svg%3E");
		}

		/* rotate icons so prev points left and next points right */
		.modal-nav button.prev::before {
			transform: rotate(90deg);
		}

		.modal-nav button.next::before {
			transform: rotate(-90deg);
		}
	</style>
</head>

<body class="bg-gray-100 text-gray-900 no-shadow">
	<main class="max-w-6xl mx-auto px-6 py-12">
		<header class="mb-8">
			<h1 class="text-6xl font-regular">Projekte</h1>
			<p class="text-sm text-gray-600 mt-1">Eine Auswahl meiner Projekte. Filtere live nach Jahr, Typ oder
				Branche. </p>
		</header>
		<section class="mb-6">
			<div class="flex flex-wrap gap-3 items-center filter-bar">
				<input id="search" type="search" placeholder="Suche Projekt, Agentur…"
					class="w-full md:w-64 px-4 h-12 text-base rounded-full border border-gray-200 bg-white placeholder-gray-400"
					aria-label="Suche Referenzen">
				<select id="filter-year"
					class="w-full sm:w-auto md:w-48 px-4 pr-10 h-12 text-base rounded-full border border-gray-200 bg-white"
					aria-label="Filter Jahr">
					<option value="">Alle Jahre</option>
				</select>
				<select id="filter-type"
					class="w-full sm:w-auto md:w-48 px-4 pr-10 h-12 text-base rounded-full border border-gray-200 bg-white"
					aria-label="Filter Typ">
					<option value="">Alle Typen</option>
				</select>
				<select id="filter-branch"
					class="w-full sm:w-auto md:w-48 px-4 pr-10 h-12 text-base rounded-full border border-gray-200 bg-white"
					aria-label="Filter Branche">
					<option value="">Alle Branchen</option>
				</select>
				<button id="clear" type="button"
					class="px-5 h-12 text-base rounded-full bg-[#3ff390] hover:bg-[#36ce7a] text-gray-600">Zurücksetzen</button>
			</div>
			<!-- Results count -->
			<div id="results-count" class="mt-3 text-sm text-gray-600" role="status" aria-live="polite">Lade Referenzen…
			</div>
		</section>
		<div id="grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
		<!-- sentinel for infinite scroll -->
		<div id="scroll-sentinel" class="h-8"></div>
		<template id="card-template">
			<article class="card border border-gray-100 p-4 bg-white group">
				<div class="w-full aspect-square bg-gray-100 rounded-md mb-4 overflow-hidden">
					<img src="" alt="Projektbild" class="w-full h-full object-cover object-top placeholder-img"
						loading="lazy" decoding="async" fetchpriority="low" />
				</div>
				<h3 class="text-lg font-medium project-title"></h3>
				<p class="text-sm text-gray-500 mt-1 project-meta"></p>
				<div class="mt-3 flex gap-2 flex-wrap">
					<span class="text-xs text-gray-600 px-3 py-1 border border-gray-200 pill agency"></span>
					<span class="text-xs text-gray-600 px-3 py-1 border border-gray-200 pill type"></span>
				</div>
			</article>
		</template>
	</main>
	<!-- Native dialog modal for card details (updated layout) -->
	<dialog id="card-modal" aria-hidden="true">
		<div class="modal-content card w-[92vw] md:w-[70vw] bg-white p-8 mx-auto relative">
			<button id="modal-close" aria-label="Schließen"
				class="absolute top-4 right-4 z-20 w-12 h-12 rounded-full bg-white border">✕</button>
			<div class="grid md:grid-cols-3 gap-6">
				<div class="modal-image md:col-span-2 bg-gray-100 rounded-md h-64 md:h-[70vh]">
					<img id="modal-img" src="" alt="" class="w-full h-auto placeholder-img" />
				</div>
				<div class="modal-details md:col-span-1 overflow-auto">
					<h2 id="modal-title" class="text-4xl font-normal mb-6 md:mt-8"></h2>
					<div id="modal-pairs" class="details flex flex-row flex-wrap gap-8   gap-y-4 text-base"></div>
					<!-- modal navigation buttons (prev / next) -->
					<div class="modal-nav" aria-hidden="false">
						<button id="modal-prev" class="prev" title="Vorheriges" aria-label="Vorheriges"
							aria-hidden="false"></button>
						<button id="modal-next" class="next" title="Nächstes" aria-label="Nächstes"
							aria-hidden="false"></button>
					</div>
				</div>
			</div>
		</div>
	</dialog> /* Allow modal images to use natural height (don't force aspect-ratio applied to thumbnails) */
	.modal-image .placeholder-img { aspect-ratio: auto; contain-intrinsic-size: auto; }
	<script>
		// Try to fetch JSON; if not available, fallback to a single "No entries found" item
		async function loadData() {
			try {
				const res = await fetch('data/references.json');
				if (!res.ok) throw new Error('No file');
				return await res.json();
			} catch (e) {
				return [
					{ "Jahr": "", "Projekttitel": "No entries found", "Typ": "", "Branche": "", "Agentur": "" }
				];
			}
		}

		function createOption(select, value) {
			const opt = document.createElement('option');
			opt.value = value;
			opt.textContent = value;
			select.appendChild(opt);
		}

		function uniqueSorted(arr) {
			return Array.from(new Set(arr.filter(Boolean))).sort((a, b) => b.localeCompare(a));
		}

		// safe placeholder generator: handles missing/short titles
		function placeholderImage(title) {
			const safeTitle = (title || '').trim();
			const initials = safeTitle
				? safeTitle.split(/\s+/).slice(0, 2).map(w => (w[0] || '')).join('').toUpperCase()
				: '?';
			const svg = `<?xml version='1.0' encoding='utf-8'?><svg xmlns='http://www.w3.org/2000/svg' width='800' height='600'><rect width='100%' height='100%' fill='#ffffff'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='#e5e7eb' font-family='Maven Pro, Arial' font-size='96'>${initials}</text></svg>`;
			return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
		}

		(async function () {
			const data = await loadData();
			// default sort: newest year first
			data.sort((a, b) => {
				const ya = parseInt(a && a.Jahr) || 0;
				const yb = parseInt(b && b.Jahr) || 0;
				return yb - ya;
			});
			const grid = document.getElementById('grid');
			const tmpl = document.getElementById('card-template');
			const search = document.getElementById('search');
			const filterYear = document.getElementById('filter-year');
			const filterType = document.getElementById('filter-type');
			const filterBranch = document.getElementById('filter-branch');
			const clear = document.getElementById('clear');
			const resultsCountEl = document.getElementById('results-count');

			// populate filter options - skip empty/falsy values
			uniqueSorted(data.map(d => d.Jahr).filter(v => v && String(v).trim() !== '')).forEach(y => createOption(filterYear, y));
			uniqueSorted(data.map(d => d.Typ).filter(v => v && String(v).trim() !== '')).forEach(t => createOption(filterType, t));
			uniqueSorted(data.map(d => d.Branche).filter(v => v && String(v).trim() !== '')).forEach(b => createOption(filterBranch, b));

			// Pagination / infinite-scroll rendering
			const PAGE_SIZE = 24; // cards per page
			let currentList = []; // filtered list
			let renderedCount = 0;
			const sentinel = document.getElementById('scroll-sentinel');

			// shared image handlers to avoid allocating per-image functions
			function handleImageLoad(e) { e.currentTarget.classList.add('is-loaded'); }
			function handleImageError(e) { const img = e.currentTarget; img.onerror = null; img.src = placeholderImage(img.alt || ''); img.classList.add('is-loaded'); }

			function renderPage(items) {
				const frag = document.createDocumentFragment();
				items.forEach((item, i) => {
					const node = tmpl.content.cloneNode(true);
					const article = node.querySelector('article');
					const img = node.querySelector('img');
					const titleEl = node.querySelector('.project-title');
					const metaEl = node.querySelector('.project-meta');
					const agencyEl = node.querySelector('.agency');
					const typeEl = node.querySelector('.type');

					titleEl.textContent = item.Projekttitel || 'Untitled';
					metaEl.textContent = [item.Jahr, item.Branche].filter(Boolean).join(' • ');
					agencyEl.textContent = item.Agentur || '–';
					typeEl.textContent = item.Typ || '–';

					img.alt = item.Projekttitel || '';
					const imageFile = item.Image || (slugify(item.Projekttitel) + '.jpg');
					const imagePath = imageFile ? `images/referenzen/${imageFile}` : '';
					if (imagePath) {
						// reuse handlers to avoid per-image closures
						img.classList.remove('is-loaded');
						img.onload = handleImageLoad;
						img.onerror = handleImageError;
						img.src = imagePath; // set src last
					} else {
						img.src = placeholderImage(item.Projekttitel);
						img.classList.add('is-loaded');
					}

					// attach data attributes for modal population
					article.dataset.title = item.Projekttitel || '';
					article.dataset.jahr = item.Jahr || '';
					article.dataset.typ = item.Typ || '';
					article.dataset.branche = item.Branche || '';
					article.dataset.agentur = item.Agentur || '';
					article.dataset.url = (item.URL || '').trim();
					// mark all cards clickable (they open the modal) so they get the subtle hover lift
					article.classList.add('clickable-url');
					article.dataset.image = imagePath || '';

					// store absolute index in the currentList (used for modal navigation)
					article.dataset.index = renderedCount + i;

					// open modal on click
					article.addEventListener('click', (ev) => {
						ev.preventDefault();
						showModalAtIndex(parseInt(article.dataset.index, 10));
					});

					frag.appendChild(article);
				});
				grid.appendChild(frag);
			}

			function render(list) {
				// reset pagination
				currentList = list || [];
				renderedCount = 0;
				grid.innerHTML = '';
				const total = data.length || 0;
				if (resultsCountEl) resultsCountEl.textContent = `${currentList.length} von ${total} Referenzen`;
				if (!currentList.length) {
					grid.innerHTML = '<p class="text-gray-500">Keine Projekte gefunden.</p>';
					return;
				}
				renderMore();
			}

			function renderMore() {
				const next = currentList.slice(renderedCount, renderedCount + PAGE_SIZE);
				if (!next.length) { sentinel.style.display = 'none'; return; }
				renderPage(next);
				renderedCount += next.length;
				// show sentinel only if there are more items
				sentinel.style.display = renderedCount < currentList.length ? 'block' : 'none';
			}

			// IntersectionObserver for sentinel -> load more pages
			const io = new IntersectionObserver(entries => {
				entries.forEach(e => {
					if (e.isIntersecting) renderMore();
				});
			}, { root: null, rootMargin: '400px', threshold: 0 });
			io.observe(sentinel);

			function slugify(title) {
				if (!title) return '';
				return title.trim().toLowerCase()
					.replace(/ä/g, 'ae').replace(/ö/g, 'oe').replace(/ü/g, 'ue').replace(/ß/g, 'ss')
					.replace(/&/g, 'and')
					.replace(/[\s\/\\]+/g, '-')
					.replace(/[^a-z0-9\-]/g, '')
					.replace(/-+/g, '-')
					.replace(/^-+|-+$/g, '');
			}

			function normalizeUrl(raw) {
				try {
					const trimmed = String(raw).trim();
					// if it already has a scheme, return as-is
					if (/^[a-zA-Z][a-zA-Z0-9+.-]*:/.test(trimmed)) return trimmed;
					// add https by default
					return 'https://' + trimmed;
				} catch (e) { return raw; }
			}

			function applyFilters() {
				const q = search.value.trim().toLowerCase();
				const y = filterYear.value;
				const t = filterType.value;
				const b = filterBranch.value;
				let filtered = data.filter(d => {
					if (y && d.Jahr !== y) return false;
					if (t && d.Typ !== t) return false;
					if (b && d.Branche !== b) return false;
					if (q) {
						const hay = (d.Projekttitel + ' ' + (d.Agentur || '') + ' ' + (d.Typ || '') + ' ' + (d.Branche || '')).toLowerCase();
						return hay.indexOf(q) !== -1;
					}
					return true;
				});
				// keep results sorted by year (newest first)
				filtered = filtered.sort((a, b) => (parseInt(b && b.Jahr) || 0) - (parseInt(a && a.Jahr) || 0));
				render(filtered);
			}

			// debounce helper
			function debounce(fn, wait) {
				let t;
				return function (...args) {
					clearTimeout(t);
					t = setTimeout(() => fn.apply(this, args), wait);
				};
			}

			// events: debounce search for 250ms. Use the same debounce helper for selects
			// with a much smaller delay so rapid picker interactions on iOS don't trigger
			// immediate re-renders that could close the native picker.
			search.addEventListener('input', debounce(applyFilters, 250));
			const selectHandler = debounce(applyFilters, 120);
			[filterYear, filterType, filterBranch].forEach(el => el.addEventListener('change', selectHandler));
			clear.addEventListener('click', () => { search.value = ''; filterYear.value = ''; filterType.value = ''; filterBranch.value = ''; applyFilters(); });

			render(data);

			/* Modal logic: open dialog, populate details, implement vertical panning for image */

			const dialog = document.getElementById('card-modal');
			const modalImg = document.getElementById('modal-img');
			const modalTitle = document.getElementById('modal-title');
			const modalPairs = document.getElementById('modal-pairs');
			const modalClose = document.getElementById('modal-close');

			// Scroll lock helpers: preserve scroll position and lock body
			let _scrollY = 0;
			function lockBodyScroll() {
				_scrollY = window.scrollY || window.pageYOffset || document.documentElement.scrollTop || 0;
				document.body.classList.add('modal-scroll-lock');
				// set top so body appears at same position while fixed
				document.body.style.top = `-${_scrollY}px`;
			}

			function unlockBodyScroll() {
				document.body.classList.remove('modal-scroll-lock');
				document.body.style.top = '';
				// restore scroll position
				window.scrollTo(0, _scrollY);
			}

			function openCardModal(data) {
				// populate title
				modalTitle.textContent = data.title || '';
				// image
				const imgSrc = data.image || '';
				modalImg.alt = data.title || '';
				// attach shared handlers and set src last to trigger load
				modalImg.classList.remove('is-loaded');
				modalImg.onload = handleImageLoad;
				modalImg.onerror = handleImageError;
				modalImg.src = imgSrc || placeholderImage(data.title);
				// build key/value pairs - show Projekttitel as first larger title already shown
				modalPairs.innerHTML = '';
				const pairs = [
					['Jahr', data.jahr || '–'],
					['Agentur', data.agentur || '–'],
					['Typ', data.typ || '–'],
					['Branche', data.branche || '–']
				];
				pairs.forEach(([k, v]) => {
					const el = document.createElement('div');
					// keep requested classes and enforce vertical stacking with flex-col
					el.className = 'pair flex items-baseline gap-1 flex-col';
					el.innerHTML = `<div class="key text-sm text-gray-500">${k}</div><div class="value text-base text-gray-700">${v}</div>`;
					modalPairs.appendChild(el);
				});

				// show link/button if a URL is present
				if (data.url && String(data.url).trim()) {
					const raw = String(data.url).trim();
					const href = normalizeUrl(raw);
					const el = document.createElement('div');
					el.className = 'pair flex items-baseline gap-1 flex-col';
					const key = document.createElement('div');
					key.className = 'key text-sm text-gray-500';
					key.textContent = 'Website';
					const val = document.createElement('div');
					val.className = 'value text-base';
					const a = document.createElement('a');
					a.href = href;
					a.target = '_blank';
					a.rel = 'noopener noreferrer';
					a.className = 'text-base text-gray-700 underline';
					// if figma URL, show friendly label
					if (/figma\.com/i.test(href)) {
						a.textContent = 'Figma Prototype';
					} else {
						a.textContent = raw;
					}
					val.appendChild(a);
					el.appendChild(key);
					el.appendChild(val);
					modalPairs.appendChild(el);
				}

				// show dialog
				if (typeof dialog.showModal === 'function') {
					dialog.showModal();
					dialog.setAttribute('aria-hidden', 'false');
					// lock background scroll while modal is open
					lockBodyScroll();
				} else {
					// fallback for old browsers
					dialog.style.display = 'block';
					lockBodyScroll();
				}

				// ensure CSS-based placeholder pan is used
				modalImg.style.transform = '';
			}

			// -- modal navigation (global) --
			let _currentIndex = -1;

			function showModalAtIndex(idx) {
				if (!Array.isArray(currentList) || !currentList.length) return;
				if (idx < 0) idx = currentList.length - 1; // wrap
				if (idx >= currentList.length) idx = 0; // wrap
				_currentIndex = idx;
				const item = currentList[_currentIndex];
				// populate modal fields
				modalTitle.textContent = item.Projekttitel || '';
				const imgPath = item.Image || (slugify(item.Projekttitel) + '.jpg');
				const imagePath = imgPath ? `images/referenzen/${imgPath}` : '';
				modalImg.alt = item.Projekttitel || '';
				modalImg.classList.remove('is-loaded');
				modalImg.onload = handleImageLoad;
				modalImg.onerror = handleImageError;
				modalImg.src = imagePath || placeholderImage(item.Projekttitel);
				modalPairs.innerHTML = '';
				[['Jahr', item.Jahr || '–'], ['Agentur', item.Agentur || '–'], ['Typ', item.Typ || '–'], ['Branche', item.Branche || '–']]
					.forEach(([k, v]) => {
						const el = document.createElement('div');
						el.className = 'pair flex items-baseline gap-1 flex-col';
						el.innerHTML = `<div class="key text-sm text-gray-500">${k}</div><div class="value text-base text-gray-700">${v}</div>`;
						modalPairs.appendChild(el);
					});

				// Website link if present in data (item may have URL or url)
				const rawUrl = item.URL || item.url || '';
				if (rawUrl && String(rawUrl).trim()) {
					const raw = String(rawUrl).trim();
					const href = normalizeUrl(raw);
					const el = document.createElement('div');
					el.className = 'pair flex items-baseline gap-1 flex-col';
					const isFigma = /figma\.com/i.test(href);
					el.innerHTML = `<div class="key text-sm text-gray-500">Website</div><div class="value text-base"><a class="text-base text-gray-700 underline" target="_blank" rel="noopener noreferrer" href="${href}">${isFigma ? 'Figma Prototype' : raw}</a></div>`;
					modalPairs.appendChild(el);
				}

				if (typeof dialog.showModal === 'function' && !dialog.open) {
					dialog.showModal();
					dialog.setAttribute('aria-hidden', 'false');
					lockBodyScroll();
				} else if (!dialog.open) {
					dialog.style.display = 'block';
					lockBodyScroll();
				}
			}

			function modalPrev() { showModalAtIndex(_currentIndex - 1); }
			function modalNext() { showModalAtIndex(_currentIndex + 1); }

			// wire buttons
			const modalPrevBtn = document.getElementById('modal-prev');
			const modalNextBtn = document.getElementById('modal-next');
			if (modalPrevBtn) modalPrevBtn.addEventListener('click', (e) => { e.stopPropagation(); modalPrev(); });
			if (modalNextBtn) modalNextBtn.addEventListener('click', (e) => { e.stopPropagation(); modalNext(); });

			// keyboard navigation (left/right arrows) while dialog open
			document.addEventListener('keydown', (e) => {
				if (!dialog.open) return;
				if (e.key === 'ArrowLeft') { e.preventDefault(); modalPrev(); }
				if (e.key === 'ArrowRight') { e.preventDefault(); modalNext(); }
			});

			function closeCardModal() {
				if (typeof dialog.close === 'function') dialog.close();
				dialog.setAttribute('aria-hidden', 'true');
				// unlock background scroll
				unlockBodyScroll();
			}

			modalClose.addEventListener('click', closeCardModal);
			dialog.addEventListener('click', (e) => {
				// close when clicking backdrop area (dialog element itself)
				if (e.target === dialog) closeCardModal();
			});

			document.addEventListener('keydown', (e) => {
				if (e.key === 'Escape' && dialog.open) closeCardModal();
			});

			// manual panning removed; modal image uses CSS object-position animation
		})();
	</script>
</body>

</html>