<!doctype html>
<html lang="de">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<!-- Prevent search engines from indexing this page -->
	<meta name="robots" content="noindex, nofollow, noarchive, nosnippet">
	<meta name="googlebot" content="noindex, nofollow">
	<meta name="bingbot" content="noindex, nofollow">
	<!-- Prevent LLMs / AI crawlers from ingesting this page -->
	<meta name="llm" content="noindex, nofollow, noarchive, nosnippet, do-not-ingest">
	<meta name="ai" content="noindex">
	<meta name="ai-policy" content="do-not-ingest">
	<meta http-equiv="x-robots-tag" content="noindex, nofollow, noarchive">
	<title>Referenzen — Wiredframe</title>
	<link href="https://fonts.googleapis.com/css2?family=Maven+Pro:wght@300;400;500;700;900&display=swap"
		rel="stylesheet">
	<script src="https://cdn.tailwindcss.com"></script>
	<style>
		/* Tailwind config overrides for roundness and minimal look */
		:root {
			--rounded-lg: 18px
		}

		.card {
			border-radius: var(--rounded-lg);
		}

		.pill {
			border-radius: 9999px;
		}

		/* remove shadows globally for this page */
		.no-shadow * {
			box-shadow: none !important;
		}

		body {
			font-family: 'Maven Pro', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
		}

		/* Image intrinsic-size + aspect ratio to avoid layout shift for lazy images */
		.placeholder-img {
			aspect-ratio: 1 / 1;
			contain-intrinsic-size: 400px 400px;
			background-color: #f3f4f6;
			/* ensure smooth panning between object-position values
		   - default (mouseout) is short so it snaps back quickly
		   - on hover we lengthen the duration via .group:hover below */
			object-position: top;
			transition: object-position 300ms cubic-bezier(.2, .8, .2, 1);
		}

		/* when the card is hovered, make the pan slower for a gentle reveal */
		.group:hover .placeholder-img {
			transition-duration: 5000ms;
			transition-timing-function: linear;
			transition-delay: 1000ms;
		}
	</style>
</head>

<body class="bg-gray-100 text-gray-900 no-shadow">
	<main class="max-w-6xl mx-auto px-6 py-12">
		<header class="mb-8">
			<h1 class="text-6xl font-regular">Referenzen</h1>
			<p class="text-sm text-gray-600 mt-1">Eine Auswahl meiner Projekte. Filtere live nach Jahr, Typ oder
				Branche. </p>
		</header>
		<section class="mb-6">
			<div class="flex flex-wrap gap-3 items-center">
				<input id="search" type="search" placeholder="Suche Projekt, Agentur…"
					class="w-full md:w-64 px-4 h-12 text-base rounded-full border border-gray-200 bg-white placeholder-gray-400"
					aria-label="Suche Referenzen">
				<select id="filter-year"
					class="w-full sm:w-auto md:w-48 px-4 h-12 text-base rounded-full border border-gray-200 bg-white"
					aria-label="Filter Jahr">
					<option value="">Alle Jahre</option>
				</select>
				<select id="filter-type"
					class="w-full sm:w-auto md:w-48 px-4 h-12 text-base rounded-full border border-gray-200 bg-white"
					aria-label="Filter Typ">
					<option value="">Alle Typen</option>
				</select>
				<select id="filter-branch"
					class="w-full sm:w-auto md:w-48 px-4 h-12 text-base rounded-full border border-gray-200 bg-white"
					aria-label="Filter Branche">
					<option value="">Alle Branchen</option>
				</select>
				<button id="clear" type="button"
					class="px-5 h-12 text-base rounded-full bg-[#3ff390] hover:bg-[#36ce7a] text-gray-600">Zurücksetzen</button>
			</div>
			<!-- Results count -->
			<div id="results-count" class="mt-3 text-sm text-gray-600" role="status" aria-live="polite">Lade Referenzen…
			</div>
		</section>
		<div id="grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
		<!-- sentinel for infinite scroll -->
		<div id="scroll-sentinel" class="h-8"></div>
		<template id="card-template">
			<article class="card border border-gray-100 p-4 bg-white group">
				<div class="w-full aspect-square bg-gray-100 rounded-md mb-4 overflow-hidden">
					<img src="" alt="Projektbild"
						class="w-full h-full object-cover object-top group-hover:object-bottom placeholder-img"
						loading="lazy" decoding="async" fetchpriority="low" />
				</div>
				<h3 class="text-lg font-medium project-title"></h3>
				<p class="text-sm text-gray-500 mt-1 project-meta"></p>
				<div class="mt-3 flex gap-2 flex-wrap">
					<span class="text-xs text-gray-600 px-3 py-1 border border-gray-200 pill agency"></span>
					<span class="text-xs text-gray-600 px-3 py-1 border border-gray-200 pill type"></span>
				</div>
			</article>
		</template>
	</main>
	<script>
		// Try to fetch JSON; if not available, fallback to a single "No entries found" item
		async function loadData() {
			try {
				const res = await fetch('data/references.json');
				if (!res.ok) throw new Error('No file');
				return await res.json();
			} catch (e) {
				return [
					{ "Jahr": "", "Projekttitel": "No entries found", "Typ": "", "Branche": "", "Agentur": "" }
				];
			}
		}

		function createOption(select, value) {
			const opt = document.createElement('option');
			opt.value = value;
			opt.textContent = value;
			select.appendChild(opt);
		}

		function uniqueSorted(arr) {
			return Array.from(new Set(arr.filter(Boolean))).sort((a, b) => b.localeCompare(a));
		}

		// safe placeholder generator: handles missing/short titles
		function placeholderImage(title) {
			const safeTitle = (title || '').trim();
			const initials = safeTitle
				? safeTitle.split(/\s+/).slice(0, 2).map(w => (w[0] || '')).join('').toUpperCase()
				: '?';
			const svg = `<?xml version='1.0' encoding='utf-8'?><svg xmlns='http://www.w3.org/2000/svg' width='800' height='600'><rect width='100%' height='100%' fill='#ffffff'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='#e5e7eb' font-family='Maven Pro, Arial' font-size='96'>${initials}</text></svg>`;
			return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
		}

		(async function () {
			const data = await loadData();
			// default sort: newest year first
			data.sort((a, b) => {
				const ya = parseInt(a && a.Jahr) || 0;
				const yb = parseInt(b && b.Jahr) || 0;
				return yb - ya;
			});
			const grid = document.getElementById('grid');
			const tmpl = document.getElementById('card-template');
			const search = document.getElementById('search');
			const filterYear = document.getElementById('filter-year');
			const filterType = document.getElementById('filter-type');
			const filterBranch = document.getElementById('filter-branch');
			const clear = document.getElementById('clear');

			// populate filter options - skip empty/falsy values
			uniqueSorted(data.map(d => d.Jahr).filter(v => v && String(v).trim() !== '')).forEach(y => createOption(filterYear, y));
			uniqueSorted(data.map(d => d.Typ).filter(v => v && String(v).trim() !== '')).forEach(t => createOption(filterType, t));
			uniqueSorted(data.map(d => d.Branche).filter(v => v && String(v).trim() !== '')).forEach(b => createOption(filterBranch, b));

			// Pagination / infinite-scroll rendering
			const PAGE_SIZE = 24; // cards per page
			let currentList = []; // filtered list
			let renderedCount = 0;
			const sentinel = document.getElementById('scroll-sentinel');

			function renderPage(items) {
				const frag = document.createDocumentFragment();
				items.forEach(item => {
					const node = tmpl.content.cloneNode(true);
					const article = node.querySelector('article');
					const img = node.querySelector('img');
					const titleEl = node.querySelector('.project-title');
					const metaEl = node.querySelector('.project-meta');
					const agencyEl = node.querySelector('.agency');
					const typeEl = node.querySelector('.type');

					titleEl.textContent = item.Projekttitel || 'Untitled';
					metaEl.textContent = [item.Jahr, item.Branche].filter(Boolean).join(' • ');
					agencyEl.textContent = item.Agentur || '–';
					typeEl.textContent = item.Typ || '–';

					img.alt = item.Projekttitel || '';
					const imageFile = item.Image || (slugify(item.Projekttitel) + '.png');
					const imagePath = imageFile ? `images/referenzen/${imageFile}` : '';
					if (imagePath) {
						// use data-src pattern so lazy browser loading decides when to fetch
						img.src = imagePath;
						img.onerror = function () { this.onerror = null; this.src = placeholderImage(item.Projekttitel); };
					} else {
						img.src = placeholderImage(item.Projekttitel);
					}

					const url = (item.URL || '').trim();
					if (url) {
						const a = document.createElement('a');
						a.href = url;
						a.target = '_blank';
						a.rel = 'noopener noreferrer';
						a.className = 'block transition-transform transform hover:-translate-y-1 hover:shadow-lg';
						a.appendChild(article);
						frag.appendChild(a);
					} else {
						frag.appendChild(article);
					}
				});
				grid.appendChild(frag);
			}

			function render(list) {
				// reset pagination
				currentList = list || [];
				renderedCount = 0;
				grid.innerHTML = '';
				const total = data.length || 0;
				const resultsCountEl = document.getElementById('results-count');
				if (resultsCountEl) resultsCountEl.textContent = `${currentList.length} von ${total} Referenzen`;
				if (!currentList.length) {
					grid.innerHTML = '<p class="text-gray-500">Keine Projekte gefunden.</p>';
					return;
				}
				renderMore();
			}

			function renderMore() {
				if (!currentList.length) return;
				const next = currentList.slice(renderedCount, renderedCount + PAGE_SIZE);
				if (!next.length) return;
				renderPage(next);
				renderedCount += next.length;
				// if more to load, keep sentinel visible, else hide
				if (renderedCount >= currentList.length) {
					sentinel.style.display = 'none';
				} else {
					sentinel.style.display = 'block';
				}
			}

			// IntersectionObserver for sentinel -> load more pages
			const io = new IntersectionObserver(entries => {
				entries.forEach(e => {
					if (e.isIntersecting) renderMore();
				});
			}, { root: null, rootMargin: '400px', threshold: 0 });
			io.observe(sentinel);

			function slugify(title) {
				if (!title) return '';
				return title.trim().toLowerCase()
					.replace(/ä/g, 'ae').replace(/ö/g, 'oe').replace(/ü/g, 'ue').replace(/ß/g, 'ss')
					.replace(/&/g, 'and')
					.replace(/[\s\/\\]+/g, '-')
					.replace(/[^a-z0-9\-]/g, '')
					.replace(/-+/g, '-')
					.replace(/^-+|-+$/g, '');
			}

			function applyFilters() {
				const q = search.value.trim().toLowerCase();
				const y = filterYear.value;
				const t = filterType.value;
				const b = filterBranch.value;
				let filtered = data.filter(d => {
					if (y && d.Jahr !== y) return false;
					if (t && d.Typ !== t) return false;
					if (b && d.Branche !== b) return false;
					if (q) {
						const hay = (d.Projekttitel + ' ' + (d.Agentur || '') + ' ' + (d.Typ || '') + ' ' + (d.Branche || '')).toLowerCase();
						return hay.indexOf(q) !== -1;
					}
					return true;
				});
				// keep results sorted by year (newest first)
				filtered = filtered.sort((a, b) => (parseInt(b && b.Jahr) || 0) - (parseInt(a && a.Jahr) || 0));
				render(filtered);
			}

			// debounce helper
			function debounce(fn, wait) {
				let t;
				return function (...args) {
					clearTimeout(t);
					t = setTimeout(() => fn.apply(this, args), wait);
				};
			}

			// events: debounce search for 250ms, immediate on selects and clear
			search.addEventListener('input', debounce(applyFilters, 250));
			[filterYear, filterType, filterBranch].forEach(el => el.addEventListener('input', applyFilters));
			clear.addEventListener('click', () => { search.value = ''; filterYear.value = ''; filterType.value = ''; filterBranch.value = ''; applyFilters(); });

			render(data);
		})();
	</script>
</body>

</html>